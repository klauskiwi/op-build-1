From 8918d5684602709304423e00fa151e8356cea4d6 Mon Sep 17 00:00:00 2001
From: Klaus Heinrich Kiwi <klaus@linux.vnet.ibm.com>
Date: Thu, 19 Nov 2020 17:21:28 -0300
Subject: [PATCH 1/2] Adjust AXONE layout for 16.67MB BOOTKERNEL

Similar reasoning as 'f6f278e Increase BOOTKERNEL to 16.67MB'

Signed-off-by: Klaus Heinrich Kiwi <klaus@linux.vnet.ibm.com>
---
 p9Layouts/axonePnorLayout_64.xml | 47 ++++++++++++++++----------------
 1 file changed, 24 insertions(+), 23 deletions(-)

diff --git a/p9Layouts/axonePnorLayout_64.xml b/p9Layouts/axonePnorLayout_64.xml
index 5beeeb5..32835b0 100644
--- a/p9Layouts/axonePnorLayout_64.xml
+++ b/p9Layouts/axonePnorLayout_64.xml
@@ -188,10 +188,10 @@ Layout Description
         <readOnly/>
     </section>
     <section>
-        <description>Bootloader Kernel (15.5MB)</description>
+        <description>Bootloader Kernel (16.67MB)</description>
         <eyeCatch>BOOTKERNEL</eyeCatch>
         <physicalOffset>0xEC1000</physicalOffset>
-        <physicalRegionSize>0xF80000</physicalRegionSize>
+        <physicalRegionSize>0x12C0000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
         <readOnly/>
@@ -199,7 +199,7 @@ Layout Description
     <section>
         <description>OCC Lid (1.125M)</description>
         <eyeCatch>OCC</eyeCatch>
-        <physicalOffset>0x1E41000</physicalOffset>
+        <physicalOffset>0x2181000</physicalOffset>
         <physicalRegionSize>0x120000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
@@ -209,7 +209,7 @@ Layout Description
     <section>
         <description>Checkstop FIR data (12K)</description>
         <eyeCatch>FIRDATA</eyeCatch>
-        <physicalOffset>0x1F61000</physicalOffset>
+        <physicalOffset>0x22A1000</physicalOffset>
         <physicalRegionSize>0x3000</physicalRegionSize>
         <side>sideless</side>
         <ecc/>
@@ -219,7 +219,7 @@ Layout Description
     <section>
         <description>CAPP Lid (144K)</description>
         <eyeCatch>CAPP</eyeCatch>
-        <physicalOffset>0x1F64000</physicalOffset>
+        <physicalOffset>0x22A4000</physicalOffset>
         <physicalRegionSize>0x24000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
@@ -229,7 +229,7 @@ Layout Description
     <section>
         <description>BMC Inventory (36K)</description>
         <eyeCatch>BMC_INV</eyeCatch>
-        <physicalOffset>0x1F88000</physicalOffset>
+        <physicalOffset>0x22C8000</physicalOffset>
         <physicalRegionSize>0x9000</physicalRegionSize>
         <side>sideless</side>
         <reprovision/>
@@ -237,7 +237,7 @@ Layout Description
     <section>
         <description>Hostboot Bootloader (28K)</description>
         <eyeCatch>HBBL</eyeCatch>
-        <physicalOffset>0x1F91000</physicalOffset>
+        <physicalOffset>0x22D1000</physicalOffset>
         <!-- Physical Size includes Header rounded to ECC valid size -->
         <!-- Max size of actual HBBL content is 20K and 22.5K with ECC -->
         <physicalRegionSize>0x7000</physicalRegionSize>
@@ -249,7 +249,7 @@ Layout Description
     <section>
         <description>Temporary Attribute Override (32K)</description>
         <eyeCatch>ATTR_TMP</eyeCatch>
-        <physicalOffset>0x1F98000</physicalOffset>
+        <physicalOffset>0x22D8000</physicalOffset>
         <physicalRegionSize>0x8000</physicalRegionSize>
         <side>sideless</side>
         <reprovision/>
@@ -257,7 +257,7 @@ Layout Description
     <section>
         <description>PNOR Version (4K)</description>
         <eyeCatch>VERSION</eyeCatch>
-        <physicalOffset>0x1FA0000</physicalOffset>
+        <physicalOffset>0x22E0000</physicalOffset>
         <physicalRegionSize>0x2000</physicalRegionSize>
         <side>A</side>
         <sha512Version/>
@@ -266,7 +266,7 @@ Layout Description
     <section>
         <description>Permanent Attribute Override (32K)</description>
         <eyeCatch>ATTR_PERM</eyeCatch>
-        <physicalOffset>0x1FA2000</physicalOffset>
+        <physicalOffset>0x22E2000</physicalOffset>
         <physicalRegionSize>0x8000</physicalRegionSize>
         <side>sideless</side>
         <ecc/>
@@ -276,7 +276,7 @@ Layout Description
     <section>
         <description>IMA Catalog (256K)</description>
         <eyeCatch>IMA_CATALOG</eyeCatch>
-        <physicalOffset>0x1FAA000</physicalOffset>
+        <physicalOffset>0x22EA000</physicalOffset>
         <physicalRegionSize>0x40000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
@@ -286,7 +286,7 @@ Layout Description
     <section>
         <description>Ref Image Ring Overrides (128K)</description>
         <eyeCatch>RINGOVD</eyeCatch>
-        <physicalOffset>0x1FEA000</physicalOffset>
+        <physicalOffset>0x232A000</physicalOffset>
         <physicalRegionSize>0x20000</physicalRegionSize>
         <side>sideless</side>
     </section>
@@ -295,7 +295,7 @@ Layout Description
         <!-- We need 266KB per module sort, going to support
                           10 tables by default, plus ECC  -->
         <eyeCatch>WOFDATA</eyeCatch>
-        <physicalOffset>0x200A000</physicalOffset>
+        <physicalOffset>0x234A000</physicalOffset>
         <physicalRegionSize>0x300000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
@@ -305,7 +305,7 @@ Layout Description
     <section>
         <description>Hostboot deconfig area (20KB)</description>
         <eyeCatch>HB_VOLATILE</eyeCatch>
-        <physicalOffset>0x230A000</physicalOffset>
+        <physicalOffset>0x264A000</physicalOffset>
         <physicalRegionSize>0x5000</physicalRegionSize>
         <side>sideless</side>
         <reprovision/>
@@ -316,7 +316,7 @@ Layout Description
     <section>
         <description>SecureBoot Key Transition Partition (16K)</description>
         <eyeCatch>SBKT</eyeCatch>
-        <physicalOffset>0x230F000</physicalOffset>
+        <physicalOffset>0x264F000</physicalOffset>
         <physicalRegionSize>0x4000</physicalRegionSize>
         <side>sideless</side>
         <readOnly/>
@@ -325,7 +325,7 @@ Layout Description
     <section>
         <description>HDAT Data (32K)</description>
         <eyeCatch>HDAT</eyeCatch>
-        <physicalOffset>0x2313000</physicalOffset>
+        <physicalOffset>0x2653000</physicalOffset>
         <physicalRegionSize>0x8000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
@@ -335,7 +335,7 @@ Layout Description
     <section>
         <description>Ultravisor binary image (1MB)</description>
         <eyeCatch>UVISOR</eyeCatch>
-        <physicalOffset>0x231B000</physicalOffset>
+        <physicalOffset>0x265B000</physicalOffset>
         <physicalRegionSize>0x100000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
@@ -344,7 +344,7 @@ Layout Description
     <section>
         <description>Open CAPI Memory Buffer (OCMB) Firmware (1164K)</description>
         <eyeCatch>OCMBFW</eyeCatch>
-        <physicalOffset>0x241B000</physicalOffset>
+        <physicalOffset>0x275B000</physicalOffset>
         <physicalRegionSize>0x123000</physicalRegionSize>
         <side>sideless</side>
         <sha512Version/>
@@ -352,11 +352,12 @@ Layout Description
         <ecc/>
     </section>
     <section>
-        <description>Hostboot Extended image (25 MB w/ ECC)</description>
+        <description>Hostboot Extended image (23.4375 MB w/ ECC)</description>
         <eyeCatch>HBI</eyeCatch>
-        <physicalOffset>0x253E000</physicalOffset>
-        <!--0x1AC2000 Is all the space that is left, do a little less than that-->
-        <physicalRegionSize>0x1900000</physicalRegionSize>  
+        <physicalOffset>0x287E000</physicalOffset>
+        <!--Considering HBRT_PROXY below, 0x177A000 Is all the space that is left.
+            Do a little less than that-->
+        <physicalRegionSize>0x1770000</physicalRegionSize>  
         <sha512Version/>
         <side>sideless</side>
         <readOnly/>
@@ -365,7 +366,7 @@ Layout Description
     <section>
         <description>Hostboot Runtime Proxy (32KB)</description>
         <eyeCatch>HBRT_PROXY</eyeCatch>
-        <physicalOffset>0x3E3E000</physicalOffset>
+        <physicalOffset>0x3FEE000</physicalOffset>
         <physicalRegionSize>0x8000</physicalRegionSize>
         <sha512Version/>
         <side>sideless</side>
-- 
2.17.1

